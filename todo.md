# Список задач для проекта MarketFlow

## 1. Настройка архитектуры
- [x] Настроить гексагональную архитектуру
  - [x] Определить доменный слой (бизнес-логика и модели)
  - [x] Создать прикладной слой (сценарии использования и оркестрация)
  - [x] Реализовать слой адаптеров (порты и адаптеры)
    - [x] Веб-адаптер для REST API
    - [x] Адаптер хранилища для PostgreSQL
    - [x] Адаптер кэша для Redis
    - [x] Адаптер бирж для рыночных данных

## 2. Управление конфигурацией
- [x] Создать формат конфигурационного файла
- [x] Реализовать загрузку конфигурации
  - [x] Параметры подключения к PostgreSQL
  - [x] Параметры подключения к Redis
  - [x] Параметры подключения к биржам

## 3. Настройка базы данных
- [x] Настроить подключение к PostgreSQL
- [x] Создать таблицу с необходимыми полями:
  - [x] pair_name (строка)
  - [x] exchange (строка)
  - [x] timestamp (метка времени)
  - [x] average_price (число с плавающей точкой)
  - [x] min_price (число с плавающей точкой)
  - [x] max_price (число с плавающей точкой)

## 4. Источники данных
- [ ] Реализовать режим Live Mode
  - [x] Создать подключения к биржам через порты 40101, 40102, 40103
  - [ ] Настроить парсинг данных для требуемых криптовалютных пар (BTCUSDT, DOGEUSDT, TONUSDT, SOLUSDT, ETHUSDT)
  - [ ] Реализовать механизм восстановления соединения
- [ ] Реализовать режим Test Mode
  - [ ] Создать генератор тестовых данных
  - [ ] Реализовать симуляцию данных для требуемых криптовалютных пар

## 5. Реализация параллелизма
- [ ] Реализовать паттерн Fan-in (агрегация множества потоков данных)
- [ ] Реализовать паттерн Fan-out (распределение обновлений между обработчиками)
- [ ] Создать пул обработчиков (5 обработчиков на биржу)
- [ ] Реализовать пакетную обработку данных перед вставкой в PostgreSQL
- [ ] Добавить механизм резервного копирования в случае недоступности Redis

## 6. Обработка данных
- [ ] Настроить кэширование в Redis для последних данных о ценах (последняя минута)
- [ ] Создать поминутный процесс агрегации
  - [ ] Рассчитать среднюю цену для каждой пары
  - [ ] Отслеживать минимальные и максимальные значения цен
  - [ ] Сохранять агрегированные данные в PostgreSQL
- [ ] Реализовать очистку устаревших данных в Redis

## 7. Реализация API
- [ ] API рыночных данных
  - [ ] GET /prices/latest/{symbol}
  - [ ] GET /prices/latest/{exchange}/{symbol}
  - [ ] GET /prices/highest/{symbol}
  - [ ] GET /prices/highest/{exchange}/{symbol}
  - [ ] GET /prices/highest/{symbol}?period={duration}
  - [ ] GET /prices/highest/{exchange}/{symbol}?period={duration}
  - [ ] GET /prices/lowest/{symbol}
  - [ ] GET /prices/lowest/{exchange}/{symbol}
  - [ ] GET /prices/lowest/{symbol}?period={duration}
  - [ ] GET /prices/lowest/{exchange}/{symbol}?period={duration}
  - [ ] GET /prices/average/{symbol}
  - [ ] GET /prices/average/{exchange}/{symbol}
  - [ ] GET /prices/average/{exchange}/{symbol}?period={duration}
- [ ] API режима данных
  - [ ] POST /mode/test
  - [ ] POST /mode/live
- [ ] Системное здоровье
  - [ ] GET /health

## 8. Логгирование и мониторинг
- [x] Настроить пакет log/slog
- [x] Реализовать различные уровни логирования (Info, Warning, Error)
- [x] Добавить контекстную информацию в логи

## 9. Жизненный цикл приложения
- [ ] Реализовать корректное завершение работы
  - [ ] Обрабатывать сигналы завершения (SIGINT, SIGTERM)
  - [ ] Очищать ресурсы при выходе

## 10. Тестирование и документация
- [ ] Создать модульные тесты для основных компонентов
- [ ] Добавить интеграционные тесты для API-эндпоинтов
- [ ] Документировать архитектуру и компоненты системы
- [ ] Написать инструкции по использованию

## 11. Сборка и развертывание
- [ ] Убедиться, что код соответствует стандартам gofumpt
- [ ] Создать команду сборки (go build -o marketflow .)
- [ ] Настроить правильную обработку ошибок и коды выхода
- [x] Docker-упаковка